{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google" content="notranslate">
    <title>{% block title %}Django Ledger{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/beer.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
  </head>
  <body class="dark">
    
    <nav class="left m">
      <header>
        <img src="https://www.beercss.com/favicon.png" class="circle extra" loading="lazy">
        <h6>Django Ledger</h6>
      </header>
      <a href="{% url 'ledger:index' %}">
        <i>dashboard</i>
        <div>Dashboard</div>
      </a>
      <a href="{% url 'ledger:accounts' %}">
        <i>account_balance</i>
        <div>Accounts</div>
      </a>
      <a href="{% url 'ledger:transactions' %}">
        <i>receipt_long</i>
        <div>Transactions</div>
      </a>
      <a href="{% url 'ledger:create_transaction' %}">
        <i>add_circle</i>
        <div>New Transaction</div>
      </a>
      <hr>
      <a href="{% url 'ledger:trial_balance' %}">
        <i>assessment</i>
        <div>Trial Balance</div>
      </a>
      <a href="{% url 'ledger:profit_loss' %}">
        <i>trending_up</i>
        <div>Profit & Loss</div>
      </a>
      <a href="{% url 'ledger:balance_sheet' %}">
        <i>account_balance_wallet</i>
        <div>Balance Sheet</div>
      </a>
    </nav>

    <!-- Top Header Bar -->
    <header id="top-header" style="position: fixed; top: 0; left: 256px; right: 0; height: 60px; background-color: var(--surface); border-bottom: 1px solid var(--outline-variant); z-index: 999; display: flex; align-items: center; padding: 0 1rem; gap: 1rem;">
      <!-- Back Button (left) -->
      <div id="header-back-button" style="display: none;">
        <a href="#">
          <button class="circle">
            <i>arrow_back</i>
          </button>
        </a>
      </div>
      
      <!-- Left Side: Text Image + Logo (both mobile and desktop) -->
      <div id="header-left" class="header-left">
        <a href="{% url 'ledger:index' %}" style="display: flex; align-items: center; text-decoration: none; gap: 0.5rem;">
          <img src="{% static 'text.png' %}" alt="LocalMarket Text" style="height: 30px;">
          <img src="{% static 'Logo 333.png' %}" alt="LocalMarket Logo" style="height: 40px;">
        </a>
      </div>
      
      <!-- Add Button & Theme Toggle (right) -->
      <div style="margin-left: auto; display: flex; align-items: center; gap: 0.5rem;">
        <a id="header-add-button" href="{% url 'ledger:create_transaction' %}">
          <button class="circle">
            <i>add</i>
          </button>
        </a>
        <div id="theme-toggle-container"></div>
      </div>
    </header>
    
    <style>
      /* Header left side: always visible */
      .header-left {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      #header-add-button {
        display: block;
      }
      
      /* Mobile header layout (< 768px) */
      @media (max-width: 767px) {
        #header-add-button {
          display: none !important;
        }
      }
      
      /* Desktop header layout (>= 768px) */
      @media (min-width: 768px) {
        #header-add-button {
          display: block !important;
        }
      }
    </style>

    <main class="responsive" style="padding-top: 60px;">
      {% block content %}{% endblock %}
    
    <script>
      // Theme Toggle Functionality
      (function() {
        // Get stored theme or default to dark (since base is dark)
        const storedTheme = localStorage.getItem('theme') || 'dark';
        
        // Apply theme on page load
        document.body.classList.remove('dark', 'light');
        document.body.classList.add(storedTheme);
        
        // Create toggle button
        const toggleButton = document.createElement('button');
        toggleButton.className = 'circle';
        toggleButton.setAttribute('aria-label', 'Toggle theme');
        toggleButton.innerHTML = '<i>' + (storedTheme === 'light' ? 'dark_mode' : 'light_mode') + '</i>';
        
        // Add click handler
        toggleButton.addEventListener('click', function() {
          const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
          const newTheme = currentTheme === 'light' ? 'dark' : 'light';
          
          document.body.classList.remove('dark', 'light');
          document.body.classList.add(newTheme);
          localStorage.setItem('theme', newTheme);
          
          toggleButton.querySelector('i').textContent = newTheme === 'light' ? 'dark_mode' : 'light_mode';
        });
        
        // Insert into theme toggle container
        const container = document.getElementById('theme-toggle-container');
        if (container) {
          container.appendChild(toggleButton);
        }
      })();

      // Show back button on all pages except home and handle mobile layout
      document.addEventListener('DOMContentLoaded', function() {
        const headerBackButton = document.getElementById('header-back-button');
        const topHeader = document.getElementById('top-header');
        
        if (headerBackButton && topHeader) {
          const currentPath = window.location.pathname.replace(/\/$/, '') || '/';
          // Show back button on all pages except home (root path)
          if (currentPath !== '/' && currentPath !== '') {
            headerBackButton.style.display = 'block';
          }
          
          // Add click handler for back button to use History API
          const backButtonLink = headerBackButton.querySelector('a[href="#"]');
          if (backButtonLink) {
            backButtonLink.addEventListener('click', function(e) {
              e.preventDefault();
              window.history.back();
            });
          }
          
          // Adjust header position on mobile when nav is collapsed
          // Note: CSS media queries handle visibility of mobile/desktop elements
          function adjustHeaderPosition() {
            if (window.innerWidth < 768) {
              topHeader.style.left = '0';
            } else {
              topHeader.style.left = '256px';
            }
          }
          
          adjustHeaderPosition();
          window.addEventListener('resize', adjustHeaderPosition);
        }
      });
    </script>
    </main>

  </body>
</html>

