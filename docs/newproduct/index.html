<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google" content="notranslate">
    <title>Add New Product - LocalMarket</title>
    <link href="../style.css" rel="stylesheet">
  </head>
  <body>
    <!-- Desktop Top Navigation -->
    <nav class="top desktop-nav" style="display: none;">
      <div class="container">
        <div class="row no-gap">
          <div class="col s12">
            <div class="nav-content">
              <div class="nav-logo">
                <h4 class="brand-title">LocalMarket</h4>
                <div class="logo-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="#F59E0B"/>
                    <path d="M12 6L12.5 8.5L15 9L12.5 9.5L12 12L11.5 9.5L9 9L11.5 8.5L12 6Z" fill="#FCD34D"/>
                  </svg>
                </div>
              </div>
              <div class="nav-links">
                <a href="../" class="nav-link" data-testid="nav-home"><i>home</i></a>
                <a href="../" class="nav-link" data-testid="nav-search"><i>search</i></a>
                <a href="../discussions/forums/" class="nav-link" data-testid="nav-discussions"><i>groups</i></a>
                <a href="#" class="nav-link" data-testid="nav-cart"><i>shopping_cart</i></a>
                <a href="../userprofile/index.html" class="nav-link" data-testid="nav-profile"><i>person</i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav" style="display: flex; position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; background-color: var(--surface-container); border-top: 1px solid var(--outline-variant); height: 60px;">
      <a href="../index.html" class="nav-item" data-testid="mobile-nav-home" style="padding: 12px 8px; flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--on-surface);">
        <i>home</i>
      </a>
      <a href="../index.html" class="nav-item" data-testid="mobile-nav-search" style="padding: 12px 8px; flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--on-surface);">
        <i>search</i>
      </a>
      <a href="../discussions/forums/index.html" class="nav-item" data-testid="mobile-nav-discussions" style="padding: 12px 8px; flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--on-surface);">
        <i>groups</i>
      </a>
      <a href="#" class="nav-item" data-testid="mobile-nav-cart" style="padding: 12px 8px; flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--on-surface);">
        <i>shopping_cart</i>
      </a>
      <a href="../userprofile/index.html" class="nav-item active" data-testid="mobile-nav-profile" style="padding: 12px 8px; flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--on-surface);">
        <i>person</i>
      </a>
    </nav>

    <main class="responsive" style="padding-bottom: 70px;">
        <!-- Add Product Hero Section -->
        <section class="events-hero">
            <div class="hero-banner">
                <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?w=1200&h=400&fit=crop" 
                     alt="Product Banner" class="responsive round">
            </div>
            
            <div class="hero-content">
                <div class="container">
                    <div class="row">
                        <div class="col s12 center">
                            <h1 class="hero-title">Add New Product</h1>
                            <p class="hero-subtitle">Share your products with the community</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Add Product Form Section -->
        <section class="create-event-section">
            <div class="container">
                <div class="form-container">
                            <div class="form-header center">
                                <h2 class="form-title">Product Details</h2>
                                <p class="form-subtitle">Fill out the information below to add your product</p>
                            </div>
                    
                            <form class="event-form" hx-post="/api/create-product" hx-target="#form-result" hx-swap="innerHTML" data-testid="create-product-form">
                                <!-- Basic Information -->
                                <div class="form-section">
                                    <h3 class="section-title">Basic Information</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="product-name">Product Name *</label>
                                            <input type="text" id="product-name" name="name" required data-testid="product-name-input" placeholder="Enter product name">
                                        </div>
                                        <div class="form-group">
                                            <label for="product-category">Category *</label>
                                            <select id="product-category" name="category" required data-testid="product-category-select">
                                                <option value="">Select Category</option>
                                                <option value="produce">Fresh Produce</option>
                                                <option value="dairy">Dairy & Eggs</option>
                                                <option value="meat">Meat & Poultry</option>
                                                <option value="seafood">Seafood</option>
                                                <option value="bakery">Bakery</option>
                                                <option value="beverages">Beverages</option>
                                                <option value="pantry">Pantry Staples</option>
                                                <option value="prepared">Prepared Foods</option>
                                                <option value="specialty">Specialty Items</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="product-description">Description *</label>
                                        <textarea id="product-description" name="description" rows="4" required placeholder="Describe your product, its quality, and what makes it special..." data-testid="product-description-textarea"></textarea>
                                    </div>
                                </div>

                                <!-- Pricing & Inventory -->
                                <div class="form-section">
                                    <h3 class="section-title">Pricing & Inventory</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="product-price">Price *</label>
                                            <input type="number" id="product-price" name="price" min="0" step="0.01" required data-testid="product-price-input" placeholder="0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="stock-quantity">Stock Quantity *</label>
                                            <input type="number" id="stock-quantity" name="stock_quantity" min="0" required data-testid="stock-quantity-input" placeholder="0">
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Details -->
                                <div class="form-section">
                                    <h3 class="section-title">Product Details</h3>
                                    <div class="form-group">
                                        <label for="product-ingredients">Ingredients</label>
                                        <textarea id="product-ingredients" name="ingredients" rows="3" placeholder="List main ingredients or components (optional)..." data-testid="product-ingredients-textarea"></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="additional-notes">Additional Notes</label>
                                        <textarea id="additional-notes" name="notes" rows="3" placeholder="Add any additional information, storage instructions, or special notes (optional)..." data-testid="additional-notes-textarea"></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="product-image">Upload Product Image</label>
                                        <div class="upload-container">
                                            <input type="file" id="product-image" name="product_image" accept="image/*" style="display: none;" data-testid="product-image-input">
                                            <button type="button" class="btn outline upload-btn" onclick="document.getElementById('product-image').click()" data-testid="upload-image-btn">
                                                <i>cloud_upload</i>
                                                <span>Choose Image</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="form-actions center">
                                    <button type="submit" class="btn primary submit-btn" data-testid="submit-btn">Add Product</button>
                                </div>

                                <div id="form-result"></div>
                            </form>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Form validation
            const form = document.querySelector('.event-form');
            const requiredFields = form.querySelectorAll('[required]');
            const fileInput = document.getElementById('product-image');

            // File upload preview
            fileInput.addEventListener('change', function() {
                const file = this.files[0];
                const uploadBtn = document.querySelector('.upload-btn');
                
                if (file) {
                    // Update button text to show selected file
                    uploadBtn.innerHTML = `<i>check_circle</i><span>${file.name}</span>`;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Create preview image if it doesn't exist
                        let preview = document.getElementById('image-preview');
                        if (!preview) {
                            preview = document.createElement('img');
                            preview.id = 'image-preview';
                            preview.style.maxWidth = '200px';
                            preview.style.maxHeight = '150px';
                            preview.style.marginTop = '0.5rem';
                            preview.style.borderRadius = '8px';
                            preview.style.objectFit = 'cover';
                            fileInput.parentNode.appendChild(preview);
                        }
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Reset button if no file selected
                    uploadBtn.innerHTML = `<i>cloud_upload</i><span>Choose Image</span>`;
                }
            });

            // Real-time validation
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    validateField(this);
                });
            });

            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                let isValid = true;
                requiredFields.forEach(field => {
                    if (!validateField(field)) {
                        isValid = false;
                    }
                });

                if (isValid) {
                    // Show loading state
                    const submitBtn = form.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Adding Product...';
                    submitBtn.disabled = true;

                    // Simulate form submission (replace with actual HTMX handling)
                    setTimeout(() => {
                        document.getElementById('form-result').innerHTML = 
                            '<div style="color: #fffffe; background: rgba(255, 255, 254, 0.1); padding: 1rem; border-radius: 8px;">Product added successfully!</div>';
                        
                        // Reset form
                        form.reset();
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                        
                        // Reset upload button
                        const uploadBtn = document.querySelector('.upload-btn');
                        uploadBtn.innerHTML = `<i>cloud_upload</i><span>Choose Image</span>`;
                        
                        // Remove image preview if exists
                        const preview = document.getElementById('image-preview');
                        if (preview) {
                            preview.remove();
                        }
                    }, 2000);
                }
            });

            function validateField(field) {
                const value = field.value.trim();
                const isValid = value.length > 0;

                // Remove existing error styling
                field.style.borderColor = '';
                const existingError = field.parentNode.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }

                if (!isValid) {
                    field.style.borderColor = '#ff6b6b';
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message';
                    errorMsg.style.color = '#ff6b6b';
                    errorMsg.style.fontSize = '0.8rem';
                    errorMsg.style.marginTop = '0.25rem';
                    errorMsg.textContent = 'This field is required';
                    field.parentNode.appendChild(errorMsg);
                }

                return isValid;
            }

            // Smooth scroll for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/beer.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
      // Theme Toggle Functionality
      (function() {
        // Get stored theme or default to light
        const storedTheme = localStorage.getItem('theme') || 'light';
        
        // Apply theme on page load
        document.body.classList.remove('dark', 'light');
        document.body.classList.add(storedTheme);
        
        // Create toggle button
        const toggleButton = document.createElement('button');
        toggleButton.className = 'theme-toggle circle';
        toggleButton.setAttribute('aria-label', 'Toggle theme');
        toggleButton.innerHTML = '<i>' + (storedTheme === 'light' ? 'dark_mode' : 'light_mode') + '</i>';
        
        // Add click handler
        toggleButton.addEventListener('click', function() {
          const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
          const newTheme = currentTheme === 'light' ? 'dark' : 'light';
          
          document.body.classList.remove('dark', 'light');
          document.body.classList.add(newTheme);
          localStorage.setItem('theme', newTheme);
          
          toggleButton.querySelector('i').textContent = newTheme === 'light' ? 'dark_mode' : 'light_mode';
        });
        
        document.body.appendChild(toggleButton);
      })();
    </script>
  </body>
</html>

